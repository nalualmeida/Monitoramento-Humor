<!DOCTYPE html>
<html lang="pt">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Registro</title>
    <style>
        body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f9;
  margin: 0;
  padding: 0;
  height: 100%;
}

.container{
  display: flex;
  align-items: center;
  justify-content: center;
}

main{
  margin: 0;
}

header, footer{
  background-color: #6c63ff;
  color: white;
}

.form-heading {
  margin-top: 20px;
  color: #6c63ff;
}

.form-label {
  font-weight: bold;
}

.form-group {
  margin-bottom: 20px;
}

.form-control {
  width: 100%;
  padding: 10px;
  border: 1px solid #6c63ff;
  border-radius: 5px;
  box-sizing: border-box;
}

.selected {
  background-color: #5a54d4 !important;
  color: white !important;
}

.btn-group{
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
}

.btn-custom {
  background-color: transparent;
  color: black;
  padding: 1vh;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-sessoes {
  border: solid #5821c786;
}

.btn-excelente {
  border: solid #43c72186;
}

.btn-bem {
  border: solid #9bc72186;
}

.btn-mais {
  border: solid #f0e62486;
}

.btn-mal {
  border: solid #c7712186;
}

.btn-horrivel {
  border: solid #c73a2186;
}

.btn-audio{
  border: solid #de1212af;
}

.btn-custom:hover {
  background-color: #5a54d4;
}

.footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background-color: #6c63ff;
  border-top: 1px solid #ccc;
  padding: 10px 0;
}

.navbar {
  background-color: #6c63ff;
}

.navbar-nav {
  margin: 0 auto;
}

.nav-link {
  padding: 10px 15px;
  color: white;
  text-decoration: none;
  transition: color 0.3s ease;
}

.nav-link:hover {
  color: #f4f4f9;
}
    </style>
</head>

<body>
  <div class="container">

<header class="border-bottom py-3 fixed-top">
  <div class="row flex-nowrap justify-content-between align-items-center">
    <div class="text-center">
      <a class="blog-header-logo text-white text-decoration-none" href="/dashboard"><h2>Meu Humor</h2></a>
    </div>
  </div>
</header>

<main class="py-5">
  <form id="editHumorForm" action="/editHumor/<%= registro.id_registro %>" method="post" enctype="multipart/form-data" class="form">
    <div class="pt-5 *mt-2 form-group text-center">
        <input type="date" class="form-control" id="data_atual" name="data_atual" value="<%= registro.data_atual %>" required>
    </div>

    <div class="mood-buttons text-center">
      <h2 class="form-heading">Como você está?</h2>
      <div class="btn-group gap-3" role="group">
          <button onclick="selectMood(this)" class="btn-mood btn-excelente btn-custom rounded-pill px-3" type="button">excelente</button>
          <button onclick="selectMood(this)" class="btn-mood btn-bem btn-custom rounded-pill px-3" type="button">bem</button>
          <button onclick="selectMood(this)" class="btn-mood btn-mais btn-custom rounded-pill px-3" type="button">mais ou menos</button>
          <button onclick="selectMood(this)" class="btn-mood btn-mal btn-custom rounded-pill px-3" type="button">mal</button>
          <button onclick="selectMood(this)" class="btn-mood btn-horrivel btn-custom rounded-pill px-3" type="button">horrível</button>
        </div>
  </div>

  <!-- Campos ocultos para armazenar informações selecionadas -->
  <input type="hidden" name="avaliacao_humor" id="avaliacao_humor" value="<%= registro.avaliacao_humor %>" required>
  <input type="hidden" name="emocoes" id="emocoes" value="<%= registro.emocoes %>">
  <input type="hidden" name="sono" id="sono" value="<%= registro.sono %>">
  <input type="hidden" name="social" id="social" value="<%= registro.social %>">
  <input type="hidden" name="clima" id="clima" value="<%= registro.clima %>">

    <div class="form-group text-center">
      <h2 class="form-heading">Emoções</h2>
      <div class="btn-group gap-3" role="group">
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">feliz</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">empolgado(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">grato(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">descontraído(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">satisfeito(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">cansado(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">incerto(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">entediado(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">ansioso(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">com raiva</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">estressado(a)</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">triste</button>
        <button onclick="toggleEmocoes(this)" class="btn-emocoes btn-sessoes btn-custom rounded-pill px-3" type="button">desesperado(a)</button>
      </div>
      </div>
  
  
    <div class="form-group text-center">
        <h2 class="form-heading">Sono</h2>
        <div class="btn-group gap-3" role="group">
          <button onclick="selectSono(this)" class="btn-sono btn-sessoes btn-custom rounded-pill px-3" type="button">bom sono</button>
          <button onclick="selectSono(this)" class="btn-sono btn-sessoes btn-custom rounded-pill px-3" type="button">sono neutro</button>
          <button onclick="selectSono(this)" class="btn-sono btn-sessoes btn-custom rounded-pill px-3" type="button">sono ruim</button>
        </div>
    </div>
  
    <div class="form-group text-center">
        <h2 class="form-heading">Social</h2>
        <div class="btn-group gap-3" role="group">
          <button onclick="toggleSocial(this)" class="btn-social btn-sessoes btn-custom rounded-pill px-3" type="button">família</button>
          <button onclick="toggleSocial(this)" class="btn-social btn-sessoes btn-custom rounded-pill px-3" type="button">amigos</button>
          <button onclick="toggleSocial(this)" class="btn-social btn-sessoes btn-custom rounded-pill px-3" type="button">encontro</button>
          <button onclick="toggleSocial(this)" class="btn-social btn-sessoes btn-custom rounded-pill px-3" type="button">festa</button>
        </div>
    </div>
  
    <div class="form-group text-center">
        <h2 class="form-heading">Clima</h2>
        <div class="btn-group gap-3" role="group">
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">ensolarado</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">nublado</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">chuvoso</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">nevando</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">calor</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">frio</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">tempestade</button>
          <button onclick="toggleClima(this)" class="btn-clima btn-sessoes btn-custom rounded-pill px-3" type="button">vento</button>
        </div>
    </div>

    <div class="form-group text-center">
      <h2 class="form-heading">Anotações</h2>
      <div>
          <textarea class="form-control" id="anotacao" name="anotacao" rows="3"><%= registro.anotacao %></textarea>
      </div>
  </div>

  <div class="form-group text-center">
    <h2 class="form-heading">Foto</h2>
    <div>
      <input class="form-control" type="file" id="formFile" name="foto" value="/uploads/<%= registro.foto %>">
    </div>
</div>

<div class="form-group text-center mb-4">
  <h2 class="form-heading">Áudio</h2>
  <!-- <div>
      <button type="button" id="recordButton">Gravar</button>
      <button type="button" id="stopButton" disabled>Parar</button>
      <p id="recordingStatus"></p>
        <input type="hidden" class="form-control" id="audio" name="audio">
    </div> -->
  <label for="audio">Gravador de Voz:</label><br>
  <button class="btn-audio btn-custom rounded-pill px-3" type="button" id="recordButton">Gravar</button>
  <button class="btn-audio btn-custom rounded-pill px-3" type="button" id="stopButton" disabled>Parar</button>
  <p id="recordingStatus"></p>
  <input type="file" id="audioInput" name="audio" accept="audio/*" style="display:none;" value="/uploads/<%= registro.audio %>">
</div>

    <div class="container">
      <footer class="border-bottom py-2 fixed-bottom text-center">
      <div class="row align-items-center">
        <button class="btn w-100 text-white" type="submit">Salvar alterações</button>
      </div>
    </footer>
    </div>

</form>

</main>
</div>


<script>

document.getElementById('editHumorForm').addEventListener('submit', function(event) {
    var dataAtual = document.getElementById('data_atual').value;
    // var avaliacaoHumor = document.querySelector('input[name="avaliacao_humor"]:checked');

    if (!dataAtual) {
        alert("Por favor, selecione uma data para o registro.");
        event.preventDefault();
    }

    // if (!avaliacaoHumor) {
    //     alert("Por favor, nos diga como você está!");
    //     event.preventDefault();
    // }
});

// document.addEventListener('DOMContentLoaded', function() {
//     var dataAtual = document.getElementById('data_atual');
//     var hoje = new Date();
    
//     var dia = ("0" + hoje.getDate()).slice(-2);
//     var mes = ("0" + (hoje.getMonth() + 1)).slice(-2);
//     var ano = hoje.getFullYear();
    
//     var dataFormatada = `${ano}-${mes}-${dia}`;
//     dataAtual.value = dataFormatada;
    
//     // Definir o atributo max para o dia atual
//     dataAtual.setAttribute('max', dataFormatada);
// });

document.addEventListener('DOMContentLoaded', function () {
  // Definir estado inicial dos botões conforme os valores do registro
  var avaliacaoHumor = document.getElementById('avaliacao_humor').value;
  var emocoes = document.getElementById('emocoes').value.split(',').map(emocao => emocao.trim());
  var sono = document.getElementById('sono').value;
  var sociais = document.getElementById('social').value.split(',').map(social => social.trim());
  var climas = document.getElementById('clima').value.split(',').map(clima => clima.trim());

  selectedEmocoes = emocoes;
  selectedSocial = sociais;
  selectedClima = climas;

  // Atualizar os botões
  document.querySelectorAll('.btn-mood').forEach(function (btn) {
    if (btn.textContent.trim() === avaliacaoHumor) {
      btn.classList.add('selected');
    }
  });

  document.querySelectorAll('.btn-emocoes').forEach(function (btn) {
    if (emocoes.includes(btn.textContent.trim())) {
      btn.classList.add('selected');
    }
  });

  document.querySelectorAll('.btn-sono').forEach(function (btn) {
    if (btn.textContent.trim() === sono) {
      btn.classList.add('selected');
    }
  });

  document.querySelectorAll('.btn-social').forEach(function (btn) {
    if (sociais.includes(btn.textContent.trim())) {
      btn.classList.add('selected');
    }
  });

  document.querySelectorAll('.btn-clima').forEach(function (btn) {
    if (climas.includes(btn.textContent.trim())) {
      btn.classList.add('selected');
    }
  });

});

  let selectedMood = "";
  let selectedEmocoes = [];
  let selectedSono = "";
  let selectedSocial = [];
  let selectedClima = [];

  function selectMood(button) {
    selectedMood = button.innerText;
    document.getElementById("avaliacao_humor").value = selectedMood;
    document.querySelectorAll('.btn-mood').forEach(btn => btn.classList.remove('selected'));
    button.classList.add('selected');
  }

  function toggleEmocoes(button) {
    const emocao = button.textContent.trim();
    const index = selectedEmocoes.indexOf(emocao);
    if (index > -1) {
      selectedEmocoes.splice(index, 1);
      button.classList.remove('selected');
    } else {
      selectedEmocoes.push(emocao);
      button.classList.add('selected');
    }
    document.getElementById("emocoes").value = selectedEmocoes.join(', ');
  }

  function selectSono(button) {
    selectedSono = button.innerText;
    document.getElementById("sono").value = selectedSono;
    document.querySelectorAll('.btn-sono').forEach(btn => btn.classList.remove('selected'));
    button.classList.add('selected');
  }

  function toggleSocial(button) {
    const social = button.textContent.trim();
    const index = selectedSocial.indexOf(social);
    if (index > -1) {
      selectedSocial.splice(index, 1);
      button.classList.remove('selected');
    } else {
      selectedSocial.push(social);
      button.classList.add('selected');
    }
    document.getElementById("social").value = selectedSocial.join(', ');
  }

  function toggleClima(button) {
    const clima = button.textContent.trim();
    const index = selectedClima.indexOf(clima);
    if (index > -1) {
      selectedClima.splice(index, 1);
      button.classList.remove('selected');
    } else {
      selectedClima.push(clima);
      button.classList.add('selected');
    }
    document.getElementById("clima").value = selectedClima.join(', ');
  }

  let mediaRecorder;
    let audioChunks = [];

    const recordButton = document.getElementById('recordButton');
    const stopButton = document.getElementById('stopButton');
    const audioInput = document.getElementById('audioInput');
    const recordingStatus = document.getElementById('recordingStatus');

    recordButton.addEventListener('click', async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.start();

        mediaRecorder.addEventListener('dataavailable', event => {
            audioChunks.push(event.data);
        });

        mediaRecorder.addEventListener('stop', () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioFile = new File([audioBlob], 'recording.wav', { type: 'audio/wav' });

            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(audioFile);
            audioInput.files = dataTransfer.files;
        });

        recordButton.disabled = true;
        stopButton.disabled = false;
        recordingStatus.textContent = 'Gravando...';
    });

    stopButton.addEventListener('click', () => {
        mediaRecorder.stop();
        recordButton.disabled = false;
        stopButton.disabled = true;
        recordingStatus.textContent = 'Gravação finalizada.';
    });


  // function selectMood(button) {
  //   console.log("Botão clicado:", button.textContent);
  //   var buttonsMood = document.querySelectorAll('.btn-mood');
  //   buttonsMood.forEach(function(btn) {
  //     btn.classList.remove('selected');
  //   });
  //   button.classList.add('selected');
  // }

  // function toggleEmocoes(button) {
  //           button.classList.toggle('selected');
  //       }

  // function selectSono(button) {
  //   console.log("Botão clicado:", button.textContent);
  //   var buttonsSono = document.querySelectorAll('.btn-sono');
  //   buttonsSono.forEach(function(btn) {
  //     btn.classList.remove('selected');
  //   });
  //   button.classList.add('selected');
  // }

  // function toggleSocial(button) {
  //           button.classList.toggle('selected');
  //       }

  // function toggleClima(button) {
  //           button.classList.toggle('selected');
  //       }
</script>
  
</body>
</html>